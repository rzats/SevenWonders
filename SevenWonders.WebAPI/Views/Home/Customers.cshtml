
<!DOCTYPE html>

<html>
<head>
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js"></script>
    <meta name="viewport" content="width=device-width" />
    <title>Customers</title>
</head>
<body onload="myFunction()">
    <table class="table table-striped table-bordered" id="table" cellspacing="0" style="display:none;">
        <thead>
            <tr>
                <th>Id</th>
                <th>Name</th>
                <th>Last Name</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Date Of birth</th>
                <th>Status</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="tablebody">
        </tbody>
    </table>
</body>
</html>

<script>
    function myFunction()
    {
        $.ajax({
            type: "GET",
            url: "../api/CustomersManagement/GetCustomers",
            dataType: "json",
            data: {},
            success: function (responce) {
                //document.getElementById('t').value = responce;
                var tableData = '';
                $.each(responce, function(i, item)
                {
                    var active = "<td class='text-success'>Active</td>"
                    var deleted = "<td class='text-danger'>Deleted</td>"
                    var status;
                    if (responce[i].IsDeleted)
                    {
                        status = deleted;
                    }
                    else
                    {
                        status = active;
                    }

                    tableData += '<tr><td>' + responce[i].Id +
                        '</td><td>' + responce[i].FirstName +
                        '</td><td>' + responce[i].LastName +
                        '</td><td>' + responce[i].PhoneNumber +
                        '</td><td>' + responce[i].Email +
                        '</td><td>' + responce[i].DateOfBirth +
                        '</td>' + status +
                        '<td> <button class=\'btn btn-primary\' onclick=\"changeStatus(' + responce[i].Id +')\"> Change status </button> </td>'
                        '</tr>';
                });
                $('#tablebody').append(tableData);
            },

            error: function()
            {
                alert('failed to get data');
            }
        });
    }

    function changeStatus(id)
    {
        $.ajax({
            type: "POST",
            url: "../api/CustomersManagement/ChangeCustomerStatus/" + id,
            success: function()
            {
                var searchParam = id;
                var MyRows = $('table#table').find('tbody').find('tr');
                var fuckingRes;
                for (var i = 0; i < MyRows.length; i++) {
                    var MyIndexValue = $(MyRows[i]).find('td:eq(0)').html();
                    var resValue = $(MyRows[i]).find('td:eq(6)');
                    if (MyIndexValue == id) {
                        fuckingRes = resValue;
                    }
                }
                if (fuckingRes.html() == "Deleted")
                {
                    fuckingRes.html("Active");
                    fuckingRes.css('color', 'green');
                }
                else {
                    fuckingRes.html("Deleted");
                    fuckingRes.css('color', 'darkred');
                }
                
            },
            error: function()
            {
                alert('failed to change status');
            }
        });
    }
</script>


<script>
    $("#table").show();
</script>

